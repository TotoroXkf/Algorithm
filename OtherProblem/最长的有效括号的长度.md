# 最长的有效括号的长度
> 给定一个只包含 '(' 和 ')' 的字符串，找出最长的包含有效括号的子串的长度。  
> 示例 1:  
> 输入: "(()"  
> 输出: 2  
> 解释: 最长有效括号子串为 "()"  

> 示例 2:  
> 输入: ")()())"  
> 输出: 4  
> 解释: 最长有效括号子串为 "()()"

**思路** 

判断括号问题最先想到的都是栈。这个题也是利用栈解决。入栈的全部是下标，方便计算长度

- 遇到左括号就直接入栈
- 遇到右括号
    - 如果栈为空，说明没有元素和它匹配。记录下来它的位置。因为后面可能出现左括号，这个新出现的左括号代表了后面部分的最左面的左括号。所以记下来，用作往后的最左的左括号的位置。
    - 如果栈不为空
        - 说明存在括号匹配。弹出一个元素之后再看看是不是空
            - 不是空，说明还有左括号。那么就和栈顶元素相减得到长度，比较max.注意是先弹出了元素和栈顶计算长度。比如(()()()这种就能计算出正确的结果为6。而如果和弹出的元素比较则只能得到2
            - 是空，说明左边括号全部匹配，则用当前位置减去left得到这一段的值

举个例子  

| 0   | 1   | 2   | 3   | 4   | 5 | 6 | 7 | 8 | 9 | 10 |
| --- | --- | --- | --- | --- |--| -- |--  | -- |---|---|
| ( | ( | ( | ) | ) | ( | ) | )|)|(|)|


1. 最开始3个左括号入栈
2. 遇到右括号，弹出下标2，栈不为空，栈顶为1，计算3-1=2 max =2
3. 遇到右括号，弹出下标1，栈不为空，栈顶为0，计算4-0=4 max =4
4. 遇到左括号压栈
5. 遇到右括号，弹出下标5，栈不为空，栈顶为0，计算6-0=6 max =6
6. 遇到右括号，弹出下标为0，栈空，计算7-left = 8 max = 8
7. 遇到右括号，栈空，left=8
8. 遇到左括号压栈
9. 遇到右括号弹出栈顶，计算长度为10-left =2 max不变
10. 得到结果max为8


**代码**

```python
def longest_valid_parentheses(s: str):
    stack = []
    result, left, size = 0, -1, len(s)
    for i in range(size):
        if s[i] == '(':
            stack.append(i)
        elif stack:
            stack.pop(-1)
            result = max(
                result, i-left) if not stack else max(result, i-stack[-1])
        else:
            left = i
    return result
```